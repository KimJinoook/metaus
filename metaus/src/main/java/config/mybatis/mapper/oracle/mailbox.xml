<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.metaus.mailbox.model.MailboxDAO">
	<insert id="insertMailbox" parameterType="mailboxVo">
		<selectKey resultType="int" keyProperty="msgNo" order="BEFORE">
			select FP_MSG_SEQ.nextval from dual
		</selectKey>
		
		insert into fp_msg(msg_no, msg_title, msgadd_adser, msg_content)
		values(#{msgNo}, #{msgTitle}, #{msgaddAdser}, #{msgContent})
	</insert>
	
	<select id="selectMsgNo" resultType="int">
		select msg_no from fp_msg
		where rownum=1 order by msg_no desc
	</select>
	
	<insert id="insertRecipient" parameterType="RecipientVO">
		<selectKey resultType="int" keyProperty="msgaddNo" order="BEFORE">
			select fp_msgadd_SEQ.nextval from dual
		</selectKey>
		
		insert into fp_msgadd(msgadd_no, msg_no, msgadd_adsee)
		values(#{msgaddNo}, #{msgNo}, #{msgaddAdsee})
	</insert>
	
	<!-- ORACLE의 CLOB 타입의 데이터는 MyBatis를 이용해 처리할 때는 resultMap을 통해 타입 지정을 해야 함 -->
	<!-- selectMsgViewBySender -->
	<resultMap id="getMsgViewBySender" type="HashMap">
		<result property="MSG_NO" column="MSG_NO" />
		<result property="MSG_TITLE" column="MSG_TITLE" />
		<result property="MSGADD_ADSER" column="MSGADD_ADSER" />
		<result property="MSGADD_ADSEE" column="MSGADD_ADSEE" />
		<result property="MSG_CONTENT" column="MSG_CONTENT" jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>
	
	<select id="selectMsgViewBySender" parameterType="string" resultMap="getMsgViewBySender">
		select * from msgview
		where msgadd_adser=#{msgaddAdser} order by msg_no desc
	</select>
	
	<!-- selectMsgViewByRecipient -->
	<resultMap id="getMsgViewByRecipient" type="HashMap">
		<result property="MSG_NO" column="MSG_NO" />
		<result property="MSG_TITLE" column="MSG_TITLE" />
		<result property="MSGADD_ADSER" column="MSGADD_ADSER" />
		<result property="MSGADD_ADSEE" column="MSGADD_ADSEE" />
		<result property="MSG_CONTENT" column="MSG_CONTENT" jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>
	
	<select id="selectMsgViewByRecipient" parameterType="string" resultMap="getMsgViewByRecipient">
		select * from msgview
		where msgadd_adsee=#{msgaddAdsee} order by msg_no desc
	</select>
	
	<!-- selectByMsgNo -->
	<resultMap id="getByMsgNo" type="HashMap">
		<result property="MSG_NO" column="MSG_NO" />
		<result property="MSG_TITLE" column="MSG_TITLE" />
		<result property="MSGADD_ADSER" column="MSGADD_ADSER" />
		<result property="MSGADD_ADSEE" column="MSGADD_ADSEE" />
		<result property="MSG_CONTENT" column="MSG_CONTENT" jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>
	
	<select id="selectByMsgNo" parameterType="int" resultMap="getByMsgNo">
		select * from msgview
		where msg_no=#{msg_no}
	</select>
</mapper>